<?xml version="1.0" encoding="utf-8" ?>
<Patch>

    <Operation Class="PatchOperationSequence">
        <operations>

            <!-- ======================= [Stage1Rifle_BP] ========================== -->
            <li Class="PatchOperationConditional" MayRequire="CE.BlackPowderRifle">
                <xpath>Defs/ResearchProjectDef[defName="Stage1Rifle_BP"]/tab</xpath>
                <nomatch Class="PatchOperationAdd">
                    <xpath>Defs/ResearchProjectDef[defName="Stage1Rifle_BP"]</xpath>
                    <value>
                        <tab>HRK_ResearchTab_Gunsmithing</tab>
                    </value>
                </nomatch>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ResearchProjectDef[defName="Stage1Rifle_BP"]/tab</xpath>
                    <value>
                        <tab>HRK_ResearchTab_Gunsmithing</tab>
                    </value>
                </match>
            </li>

            <li Class="PatchOperationReplace" MayRequire="CE.BlackPowderRifle">
                <xpath>Defs/ResearchProjectDef[defName="Stage1Rifle_BP"]/researchViewX</xpath>
                <value>
                    <researchViewX>0</researchViewX>
                </value>
            </li>

            <li Class="PatchOperationReplace" MayRequire="CE.BlackPowderRifle">
                <xpath>Defs/ResearchProjectDef[defName="Stage1Rifle_BP"]/researchViewY</xpath>
                <value>
                    <researchViewY>1.40</researchViewY>
                </value>
            </li>

            <li Class="PatchOperationReplace" MayRequire="CE.BlackPowderRifle">
                <xpath>Defs/ResearchProjectDef[defName="Stage1Rifle_BP"]/prerequisites</xpath>
                <value>
                    <prerequisites>
                        <li>Smithing</li>
                        <li MayRequire="VanillaExpanded.VWE">VWE_Gunpowder</li>
                        <li MayRequire="CE.BlackPowderRifleGuns">Gunpowder</li>
                    </prerequisites>
                </value>
            </li>

            <!-- ======================= [Stage2Rifle_BP] ========================== -->
            <li Class="PatchOperationConditional" MayRequire="CE.BlackPowderRifle">
                <xpath>Defs/ResearchProjectDef[defName="Stage2Rifle_BP"]/tab</xpath>
                <nomatch Class="PatchOperationAdd">
                    <xpath>Defs/ResearchProjectDef[defName="Stage2Rifle_BP"]</xpath>
                    <value>
                        <tab>HRK_ResearchTab_Gunsmithing</tab>
                    </value>
                </nomatch>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ResearchProjectDef[defName="Stage2Rifle_BP"]/tab</xpath>
                    <value>
                        <tab>HRK_ResearchTab_Gunsmithing</tab>
                    </value>
                </match>
            </li>

            <li Class="PatchOperationReplace" MayRequire="CE.BlackPowderRifle">
                <xpath>Defs/ResearchProjectDef[defName="Stage2Rifle_BP"]/researchViewX</xpath>
                <value>
                    <researchViewX>1</researchViewX>
                </value>
            </li>

            <li Class="PatchOperationReplace" MayRequire="CE.BlackPowderRifle">
                <xpath>Defs/ResearchProjectDef[defName="Stage2Rifle_BP"]/researchViewY</xpath>
                <value>
                    <researchViewY>1.40</researchViewY>
                </value>
            </li>

            <!-- ======================= [AdvancedAmmo_BP] ========================== -->
            <li Class="PatchOperationConditional" MayRequire="CE.BlackPowderRifle">
                <xpath>Defs/ResearchProjectDef[defName="AdvancedAmmo_BP"]/tab</xpath>
                <nomatch Class="PatchOperationAdd">
                    <xpath>Defs/ResearchProjectDef[defName="AdvancedAmmo_BP"]</xpath>
                    <value>
                        <tab>HRK_ResearchTab_Gunsmithing</tab>
                    </value>
                </nomatch>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ResearchProjectDef[defName="AdvancedAmmo_BP"]/tab</xpath>
                    <value>
                        <tab>HRK_ResearchTab_Gunsmithing</tab>
                    </value>
                </match>
            </li>

            <li Class="PatchOperationReplace" MayRequire="CE.BlackPowderRifle">
                <xpath>Defs/ResearchProjectDef[defName="AdvancedAmmo_BP"]/researchViewX</xpath>
                <value>
                    <researchViewX>4</researchViewX>
                </value>
            </li>

            <li Class="PatchOperationReplace" MayRequire="CE.BlackPowderRifle">
                <xpath>Defs/ResearchProjectDef[defName="AdvancedAmmo_BP"]/researchViewY</xpath>
                <value>
                    <researchViewY>0</researchViewY>
                </value>
            </li>

            <li Class="PatchOperationReplace" MayRequire="CE.BlackPowderRifle">
                <xpath>Defs/ResearchProjectDef[defName="AdvancedAmmo_BP"]/label</xpath>
                <value>
                    <label>industrial ammunition</label>
                </value>
            </li>

            <!-- ======================= [Stage1R_BP] ========================== -->
            <li Class="PatchOperationConditional" MayRequire="CE_BlackPowderGuns_copy">
                <xpath>Defs/ResearchProjectDef[defName="Stage1R_BP"]/tab</xpath>
                <nomatch Class="PatchOperationAdd">
                    <xpath>Defs/ResearchProjectDef[defName="Stage1R_BP"]</xpath>
                    <value>
                        <tab>HRK_ResearchTab_Gunsmithing</tab>
                    </value>
                </nomatch>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ResearchProjectDef[defName="Stage1R_BP"]/tab</xpath>
                    <value>
                        <tab>HRK_ResearchTab_Gunsmithing</tab>
                    </value>
                </match>
            </li>

            <li Class="PatchOperationReplace" MayRequire="CE_BlackPowderGuns_copy">
                <xpath>Defs/ResearchProjectDef[defName="Stage1R_BP"]/researchViewX</xpath>
                <value>
                    <researchViewX>0</researchViewX>
                </value>
            </li>

            <li Class="PatchOperationReplace" MayRequire="CE_BlackPowderGuns_copy">
                <xpath>Defs/ResearchProjectDef[defName="Stage1R_BP"]/researchViewY</xpath>
                <value>
                    <researchViewY>2.10</researchViewY>
                </value>
            </li>

            <li Class="PatchOperationReplace" MayRequire="CE.BlackPowderRifle">
                <xpath>Defs/ResearchProjectDef[defName="Stage1R_BP"]/prerequisites</xpath>
                <value>
                    <prerequisites>
                        <li>Smithing</li>
                        <li MayRequire="VanillaExpanded.VWE">VWE_Gunpowder</li>
                        <li MayRequire="CETeam.CombatExtendedGuns">Gunpowder</li>
                    </prerequisites>
                </value>
            </li>

            <!-- ======================= [Stage2R_BP] ========================== -->
            <li Class="PatchOperationConditional" MayRequire="CE_BlackPowderGuns_copy">
                <xpath>Defs/ResearchProjectDef[defName="Stage2R_BP"]/tab</xpath>
                <nomatch Class="PatchOperationAdd">
                    <xpath>Defs/ResearchProjectDef[defName="Stage2R_BP"]</xpath>
                    <value>
                        <tab>HRK_ResearchTab_Gunsmithing</tab>
                    </value>
                </nomatch>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ResearchProjectDef[defName="Stage2R_BP"]/tab</xpath>
                    <value>
                        <tab>HRK_ResearchTab_Gunsmithing</tab>
                    </value>
                </match>
            </li>

            <li Class="PatchOperationReplace" MayRequire="CE_BlackPowderGuns_copy">
                <xpath>Defs/ResearchProjectDef[defName="Stage2R_BP"]/researchViewX</xpath>
                <value>
                    <researchViewX>1</researchViewX>
                </value>
            </li>

            <li Class="PatchOperationReplace" MayRequire="CE_BlackPowderGuns_copy">
                <xpath>Defs/ResearchProjectDef[defName="Stage2R_BP"]/researchViewY</xpath>
                <value>
                    <researchViewY>2.10</researchViewY>
                </value>
            </li>

            <!-- ======================= [REMOVE THE RESEARCH TAB] ========================== -->
            <li Class="PatchOperationFindMod">
                <mods>
                    <li>CE Black Powder revolvers</li>
                    <li>CE Black Powder Rifles WIP (Manny edition)</li>
                </mods>
                <match Class="PatchOperationSequence">
                    <operations>
                        <li Class="PatchOperationConditional">
                            <xpath>Defs/ResearchTabDef[defName="BPResearchTab"]</xpath>
                            <match Class="PatchOperationRemove" MayRequire="CE.BlackPowderRifle">
                                <xpath>Defs/ResearchTabDef[defName="BPResearchTab"]</xpath>
                            </match>
                        </li>
                    </operations>
                </match>
            </li>

        </operations>
    </Operation>
</Patch>